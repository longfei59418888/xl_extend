import EXIF from"./exif";export function formatMoney(Number,n){let _this=parseFloat(Number),dot=0===n;n=n>0&&n<=20?n:2;let formatMoney=parseFloat((_this+"").replace(/[^\d\.-]/g,"")).toFixed(n)+"",l=formatMoney.split(".")[0].split("").reverse(),r=formatMoney.split(".")[1],t="";for(let i=0;i<l.length;i++)t+=l[i]+((i+1)%3==0&&i+1!=l.length?",":"");return t.split("").reverse().join("")+(dot?"":"."+r)};export function addFloat(number1,number2){return(1e10*parseFloat(number1)+1e10*parseFloat(number2))/1e10};export function distanceFormat(distance){return(distance=parseFloat(distance))?distance>999?(distance/1e3).toFixed(2)+"km":distance+"m":""};Date.prototype.formatDate=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var k in/(y+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+k+")").test(fmt)&&(fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return fmt},Date.prototype.getCountDate=function(num){return new Date(this.setDate(this.getDate()+num)).format("yyyy-MM-dd")},Date.prototype.getMonthEnd=function(){return new Date(this.getFullYear(),this.getMonth()+1).toJSON().substring(0,10)},Date.prototype.getMonthDays=function(){var curMonth=this.getMonth();return this.setMonth(curMonth+1),this.setDate(0),this.getDate()},Date.prototype.getTheWeek=function(){var totalDays=0,years=this.getFullYear();years<1e3&&(years+=1900);var days=new Array(12);if(days[0]=31,days[2]=31,days[3]=30,days[4]=31,days[5]=30,days[6]=31,days[7]=31,days[8]=30,days[9]=31,days[10]=30,days[11]=31,Math.round(this.getYear()/4)==this.getYear()/4?days[1]=29:days[1]=28,0==this.getMonth())totalDays+=this.getDate();else{for(var curMonth=this.getMonth(),count=1;count<=curMonth;count++)totalDays+=days[count-1];totalDays+=this.getDate()}return Math.ceil(totalDays/7)};export function formatEllipsis(obj,length){return obj||"string"==typeof obj?obj.length>length?obj.slice(length):obj:""};export function formatBankFour(str){return str.substr(str.length-4)};export function formatBankSensitive(str){return(str+="").substr(0,4)+"*".repeat(str.length-8)+str.substr(str.length-4)};export function formatPhoneSensitive(str){return(str+="").substr(0,3)+"*".repeat(str.length-7)+str.substr(str.length-4)};export function formatNumberPercent(str){return 1e9*str/1e7+"%"};export function formatName(str){return str.substr(0,1)+"*".repeat(str.length-1)};export function formatBankShow(card){return(card+="").length<1?"":card.length>0&&card.length<5?card:card.length>4?card.slice(0,4)+" "+formatBankCard(card.slice(4)):void 0};const _ARRAY_NAME="[object Array]",_OBJECT_NAME="[object Object]",_FUNCTION_NAME="[object Function]";function _isType(obj){return Object.prototype.toString.call(obj)}export function isFunction(obj){return _isType(obj)==_FUNCTION_NAME};export function isObject(obj){return _isType(obj)==_OBJECT_NAME};export function isArray(obj){return _isType(obj)==_ARRAY_NAME};export function isEmptyObject(obj){for(let t in obj)return!1;return!0};export function formatMoneyInput(value,n){if(n=n||2,value.match(/^0\d/)&&(value=value.slice(1)),0==n&&(value=value.replace(/\./g,"")),value.match(/[^\d\.]/g))return value.replace(/[^\d\.]/g,"");if(value.match(/^\./))return"0.";var values=value.split(".");return 2==values.length&&values[1].length>2||3==values.length?values[0]+"."+values[1].substr(0,2):value};export function formatPhoneInput(value){return value=(value=value.replace(/^\d/g,"")).split("").filter(item=>{if(item&&""!=item)return item})};export function formatBankCardInput(card){return card=card.replace(/[^\d\w]/g,""),(card+="").length<1?"":card.length>0&&card.length<5?card:card.length>4?card.slice(0,4)+" "+formatBankCardInput(card.slice(4)):void 0};export function getVendorPrefix(){for(var style=(document.body||document.documentElement).style,vendor=["webkit","khtml","moz","ms","o"],i=0;i<vendor.length;){if("string"==typeof style[vendor[i]+"Transition"])return vendor[i];i++}};export function getTranslateInfo(t){var rst=/translate\((.+)px?,(.+)px?\)/.exec(t);return rst?{x:parseFloat(rst[1]),y:parseFloat(rst[2])}:{x:0,y:0}};export function getQueryString(name){let search=window.location.search,searchs=[],params={};return search&&-1!==search.indexOf("&")&&(searchs=search().substr(1).split("&")),searchs.forEach(item=>{if(-1!==item.indexOf("=")){let info=item.split("=");params[info[0]]=info[1]}}),name?params[name]:params};function _extend(target,source){if(_isType(source)==_ARRAY_NAME)for(var i=0;i<source.length;i++)_isType(source[i])==_ARRAY_NAME?(target[i]=source[i].concat(target[i]?target[i]:[]),_extend(target[i],source[i])):_isType(source[i])==_OBJECT_NAME?(target[i]=target[i]?target[i]:{},_extend(target[i],source[i])):target[i]=source[i];else for(var v in source)_isType(source[v])==_ARRAY_NAME?(target[v]=source[v].concat(target[v]?target[v]:[]),_extend(target[v],source[v])):_isType(source[v])==_OBJECT_NAME?(target[v]=target[v]?target[v]:{},_extend(target[v],source[v])):target[v]=source[v];return target}export function extend(target){var targets,arg=Array.from(arguments).slice(1,arguments.length);return arg.length>0&&(targets=_extend(target,arg[0])),arg.length>1?extend(targets,arg[1]):targets};export function photoCompress(file,options){EXIF.getData(file,function(){EXIF.getAllTags(this),Orientation=EXIF.getTag(this,"Orientation")});var ready=new FileReader;ready.readAsDataURL(file),ready.onload=function(){_canvasDataURL(this.result,options)}};function _canvasDataURL(path,options){let{callback:callback,quality:quality=1,mH:mH,mW:mW}=options;var img=new Image;img.src=path,img.onload=function(){var w=this.width,h=this.height,scale=w/h;mW&&mW<w&&(h=(w=mW)/scale),mH&&mH<h&&(h=mH,w=mH*scale);var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),anw=document.createAttribute("width");anw.nodeValue=w;var anh=document.createAttribute("height");anh.nodeValue=h,canvas.setAttributeNode(anw),canvas.setAttributeNode(anh),ctx.drawImage(this,0,0,w,h);var base64;if(""!=Orientation&&1!=Orientation)switch(Orientation){case 6:_rotateImg(this,"left",canvas);break;case 8:_rotateImg(this,"right",canvas);break;case 3:_rotateImg(this,"right",canvas),_rotateImg(this,"right",canvas)}base64=canvas.toDataURL("image/jpeg",quality),callback({src:path,file:_convertBase64UrlToBlob(base64)})}}function _convertBase64UrlToBlob(urlData){for(var arr=urlData.split(","),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);n--;)u8arr[n]=bstr.charCodeAt(n);return new Blob([u8arr],{type:mime,lastModified:Date.now()})}function _rotateImg(img,direction,canvas){if(null!=img){var height=img.height,width=img.width,step=2;null==step&&(step=0),"right"==direction?++step>3&&(step=0):--step<0&&(step=3);var degree=90*step*Math.PI/180,ctx=canvas.getContext("2d");switch(step){case 0:canvas.width=width,canvas.height=height,ctx.drawImage(img,0,0);break;case 1:canvas.width=height,canvas.height=width,ctx.rotate(degree),ctx.drawImage(img,0,-height);break;case 2:canvas.width=width,canvas.height=height,ctx.rotate(degree),ctx.drawImage(img,-width,-height);break;case 3:canvas.width=height,canvas.height=width,ctx.rotate(degree),ctx.drawImage(img,-width,0)}}}