import EXIF from"./exif";export function formatMoney(Number,n){let _this=parseFloat(Number);let dot=n===0;n=n>0&&n<=20?n:2;let formatMoney=parseFloat((_this+"").replace(/[^\d\.-]/g,"")).toFixed(n)+"";let l=formatMoney.split(".")[0].split("").reverse(),r=formatMoney.split(".")[1];let t="";for(let i=0;i<l.length;i++){t+=l[i]+((i+1)%3==0&&i+1!=l.length?",":"")}return t.split("").reverse().join("")+(dot?"":"."+r)};export function addFloat(number1,number2){return(parseFloat(number1)*1e10+parseFloat(number2)*1e10)/1e10};export function distanceFormat(distance){distance=parseFloat(distance);if(!distance)return"";return distance>999?(distance/1e3).toFixed(2)+"km":distance+"m"};Date.prototype.formatDate=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in o){if(new RegExp("("+k+")").test(fmt)){fmt=fmt.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}return fmt};Date.prototype.getCountDate=function(num){return new Date(this.setDate(this.getDate()+num)).format("yyyy-MM-dd")};Date.prototype.getMonthEnd=function(){return new Date(this.getFullYear(),this.getMonth()+1).toJSON().substring(0,10)};Date.prototype.getMonthDays=function(){var curMonth=this.getMonth();this.setMonth(curMonth+1);this.setDate(0);return this.getDate()};Date.prototype.getTheWeek=function(){var totalDays=0,now=this;var years=now.getFullYear();if(years<1e3)years+=1900;var days=new Array(12);days[0]=31;days[2]=31;days[3]=30;days[4]=31;days[5]=30;days[6]=31;days[7]=31;days[8]=30;days[9]=31;days[10]=30;days[11]=31;if(Math.round(now.getYear()/4)==now.getYear()/4){days[1]=29}else{days[1]=28}if(now.getMonth()==0){totalDays=totalDays+now.getDate()}else{var curMonth=now.getMonth();for(var count=1;count<=curMonth;count++){totalDays=totalDays+days[count-1]}totalDays=totalDays+now.getDate()}var week=Math.ceil(totalDays/7);return week};export function formatEllipsis(obj,length){if(!obj&&typeof obj!=="string")return"";return obj.length>length?obj.slice(length):obj};export function formatBankFour(str){return str.substr(str.length-4)};export function formatBankSensitive(str){str=str+"";return str.substr(0,4)+"*".repeat(str.length-8)+str.substr(str.length-4)};export function formatPhoneSensitive(str){str=str+"";return str.substr(0,3)+"*".repeat(str.length-7)+str.substr(str.length-4)};export function formatNumberPercent(str){return str*1e9/1e7+"%"};export function formatName(str){return str.substr(0,1)+"*".repeat(str.length-1)};export function formatBankShow(card){card=card+"";if(card.length<1)return"";if(card.length>0&&card.length<5)return card;if(card.length>4){return card.slice(0,4)+" "+formatBankCard(card.slice(4))}};const _ARRAY_NAME="[object Array]";const _OBJECT_NAME="[object Object]";const _FUNCTION_NAME="[object Function]";function _isType(obj){return Object.prototype.toString.call(obj)}export function isFunction(obj){return _isType(obj)==_FUNCTION_NAME};export function isObject(obj){return _isType(obj)==_OBJECT_NAME};export function isArray(obj){return _isType(obj)==_ARRAY_NAME};export function isEmptyObject(obj){for(let t in obj){return false}return true};export function formatMoneyInput(value,n){n=n||2;if(value.match(/^0\d/))value=value.slice(1);if(n==0)value=value.replace(/\./g,"");if(value.match(/[^\d\.]/g))return value.replace(/[^\d\.]/g,"");if(value.match(/^\./))return"0.";var values=value.split(".");if(values.length==2&&values[1].length>2||values.length==3)return values[0]+"."+values[1].substr(0,2);return value};export function formatPhoneInput(value){value=value.replace(/^\d/g,"");var val=value.split("");value=val.filter(item=>{if(item&&item!=""){return item}});return value};export function formatBankCardInput(card){card=card.replace(/[^\d\w]/g,"");card=card+"";if(card.length<1)return"";if(card.length>0&&card.length<5)return card;if(card.length>4){return card.slice(0,4)+" "+formatBankCardInput(card.slice(4))}};export function getVendorPrefix(){var body=document.body||document.documentElement,style=body.style,vendor=["webkit","khtml","moz","ms","o"],i=0;while(i<vendor.length){if(typeof style[vendor[i]+"Transition"]==="string"){return vendor[i]}i++}};export function getTranslateInfo(t){var reg=/translate\((.+)px?,(.+)px?\)/;var rst=reg.exec(t);if(rst){return{x:parseFloat(rst[1]),y:parseFloat(rst[2])}}else{return{x:0,y:0}}};export function getQueryString(name){let search=window.location.search;let searchs=[],params={};if(search&&search.indexOf("&")!==-1){searchs=search().substr(1).split("&")}searchs.forEach(item=>{if(item.indexOf("=")!==-1){let info=item.split("=");params[info[0]]=info[1]}});if(name)return params[name];return params};function _extend(target,source){if(_isType(source)==_ARRAY_NAME){for(var i=0;i<source.length;i++){if(_isType(source[i])==_ARRAY_NAME){target[i]=source[i].concat(target[i]?target[i]:[]);_extend(target[i],source[i])}else if(_isType(source[i])==_OBJECT_NAME){target[i]=target[i]?target[i]:{};_extend(target[i],source[i])}else{target[i]=source[i]}}}else{for(var v in source){if(_isType(source[v])==_ARRAY_NAME){target[v]=source[v].concat(target[v]?target[v]:[]);_extend(target[v],source[v])}else if(_isType(source[v])==_OBJECT_NAME){target[v]=target[v]?target[v]:{};_extend(target[v],source[v])}else{target[v]=source[v]}}}return target}export function extend(target){var targets,arg=Array.from(arguments).slice(1,arguments.length);if(arg.length>0){targets=_extend(target,arg[0])}if(arg.length>1){return extend(targets,arg[1])}return targets};export function photoCompress(file,options){EXIF.getData(file,function(){EXIF.getAllTags(this);Orientation=EXIF.getTag(this,"Orientation")});var ready=new FileReader;ready.readAsDataURL(file);ready.onload=function(){var re=this.result;_canvasDataURL(re,options)}};function _canvasDataURL(path,options){let{callback:callback,quality:quality=1,mH:mH,mW:mW}=options;var img=new Image;img.src=path;img.onload=function(){var that=this;var w=that.width,h=that.height,scale=w/h;if(mW&&mW<w){w=mW;h=w/scale}if(mH&&mH<h){h=mH;w=mH*scale}var canvas=document.createElement("canvas");var ctx=canvas.getContext("2d");var anw=document.createAttribute("width");anw.nodeValue=w;var anh=document.createAttribute("height");anh.nodeValue=h;canvas.setAttributeNode(anw);canvas.setAttributeNode(anh);ctx.drawImage(that,0,0,w,h);var base64=null;if(Orientation!=""&&Orientation!=1){switch(Orientation){case 6:_rotateImg(this,"left",canvas);break;case 8:_rotateImg(this,"right",canvas);break;case 3:_rotateImg(this,"right",canvas);_rotateImg(this,"right",canvas);break}}base64=canvas.toDataURL("image/jpeg",quality);callback({src:path,file:_convertBase64UrlToBlob(base64)})}}function _convertBase64UrlToBlob(urlData){var arr=urlData.split(","),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);while(n--){u8arr[n]=bstr.charCodeAt(n)}return new Blob([u8arr],{type:mime,lastModified:Date.now()})}function _rotateImg(img,direction,canvas){var min_step=0;var max_step=3;if(img==null)return;var height=img.height;var width=img.width;var step=2;if(step==null){step=min_step}if(direction=="right"){step++;step>max_step&&(step=min_step)}else{step--;step<min_step&&(step=max_step)}var degree=step*90*Math.PI/180;var ctx=canvas.getContext("2d");switch(step){case 0:canvas.width=width;canvas.height=height;ctx.drawImage(img,0,0);break;case 1:canvas.width=height;canvas.height=width;ctx.rotate(degree);ctx.drawImage(img,0,-height);break;case 2:canvas.width=width;canvas.height=height;ctx.rotate(degree);ctx.drawImage(img,-width,-height);break;case 3:canvas.width=height;canvas.height=width;ctx.rotate(degree);ctx.drawImage(img,-width,0);break}}export function isHasInstallApp(url,bak){var ifr=document.createElement("iframe");ifr.src=url;ifr.style.display="none";let timestart=(new Date).getTime();setTimeout(function(){let timeend=(new Date).getTime();if(timeend-timestart<4e3)bak();document.body.removeChild(ifr)},3e3);document.body.appendChild(ifr)};